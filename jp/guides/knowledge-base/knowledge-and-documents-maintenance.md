# ナレッジベース及びドキュメントのメンテナンス

### 1 テキストチャンクの確認

ナレッジベースにアップロードされた各ドキュメントは、テキストチャンクの形式で保存されます。チャンクリストで各チャンクの具体的なテキスト内容を確認できます。

<figure><img src="../../../img/viewing-uploaded-document-segments.png" alt=""><figcaption><p>アップロード済みのドキュメントチャンクを確認する</p></figcaption></figure>

***

### 2 チャンクの品質を確認

ドキュメントチャンクはナレッジベースアプリケーションのQ&A効果に影響を与えるため、ナレッジベースをアプリケーションに関連付ける前に、チャンクの品質を人工的に確認することが推奨されます。

文字数、識別子、またはNLPセマンティックチャンクなどの自動化されたチャンク方式は、大規模なテキストチャンクの作業量を大幅に削減できますが、チャンクの品質はドキュメント形式のテキスト構造や前後の文脈のセマンティクスにも関係します。人工的なチェックと修正を行うことで、機械によるチャンクのセマンティック認識の欠点を効果的に補うことができます。

チャンクの品質を確認する際には、一般的に以下の点に注意が必要です：

* **短すぎるチャンク**、意味が不足する可能性がある；

<figure><img src="../../../img/short-text-segments.png" alt="" width="373"><figcaption><p>短すぎるチャンク</p></figcaption></figure>

* **長すぎるチャンク**、ノイズが多すぎるためマッチングの精度が低下する可能性がある；

<figure><img src="../../../img/long-text-segments.png" alt="" width="375"><figcaption><p>長すぎるチャンク</p></figcaption></figure>

* **明らかなセマンティックカットオフ**、最大チャンク長制限を使用すると強制的なセマンティックカットオフが発生し、リコール時に内容が失われる；

<figure><img src="../../../img/semantic-truncation.png" alt="" width="357"><figcaption><p>明らかなセマンティックカットオフ</p></figcaption></figure>

***

### 3 チャンクの追加

チャンクリスト内で「チャンクを追加」をクリックすると、ドキュメント内にカスタムチャンクを1つまたは複数追加することができます。

<figure><img src="../../../img/add-a-chunk.png" alt=""><figcaption></figcaption></figure>

複数のチャンクを追加する場合は、まずCSV形式のチャンクアップロードテンプレートをダウンロードし、テンプレートに従ってExcelで全てのチャンク内容を編集し、CSVファイルを保存してからアップロードします。

<figure><img src="../../../img/bulk-add-custom-segment.png" alt=""><figcaption><p>カスタムチャンクを一括追加する</p></figcaption></figure>

***

### 4 チャンクの編集

チャンクリスト内で追加したチャンク内容を直接編集・修正することができます。テキスト内容やキーワードを含めます。

<figure><img src="../../../img/edit-segment.png" alt=""><figcaption><p>ドキュメントチャンクの編集</p></figcaption></figure>

***

### 5 メタデータ管理

異なるソースドキュメントのメタデータ情報（例：ウェブページのタイトル、URL、キーワード、説明など）をマークするために使用されます。メタデータはナレッジベースのチャンクリコールプロセスで使用され、構造化フィールドとしてリコールフィルタリングや参照元の表示に参加します。

{% hint style="info" %}
メタデータフィルタリングと参照元機能は現在のバージョンではサポートされていません。
{% endhint %}

<figure><img src="../../../img/metadata.png" alt=""><figcaption><p>メタデータ管理</p></figcaption></figure>

***

### 6 ドキュメントの追加

「ナレッジベース > ドキュメントリスト」で「ファイルを追加」をクリックすると、作成済みのナレッジベースに新しいドキュメントをアップロードするか、[Notionページ](sync-from-notion.md)を同期することができます。

ナレッジベース（Knowledge）はいくつかのドキュメント（Documents）の集合体です。ドキュメントは開発者や運営者がアップロードするか、他のデータソースから同期されます（通常、対応するデータソースの1つのファイル単位）。

<figure><img src="../../../img/en-knowledge-add-document.png" alt=""><figcaption><p>ナレッジベースに新しいドキュメントをアップロードする</p></figcaption></figure>

***

### 7 ドキュメントの無効化とアーカイブ

**無効化**：データセットは一時的にインデックス付けしたくないドキュメントやチャンクを無効化することをサポートしています。データセットドキュメントリストで無効化ボタンをクリックすると、ドキュメントが無効化されます。また、ドキュメントの詳細で無効化ボタンをクリックして、ドキュメント全体または特定のチャンクを無効化することもできます。無効化されたドキュメントはインデックスされません。無効化されたドキュメントは、有効化をクリックして無効化を解除できます。

**アーカイブ**：使用しなくなった古いドキュメントデータを削除したくない場合、アーカイブすることができます。アーカイブされたデータは表示または削除のみ可能で、編集はできません。データセットドキュメントリストでアーカイブボタンをクリックすると、ドキュメントがアーカイブされます。また、ドキュメントの詳細でアーカイブをクリックすることもできます。アーカイブされたドキュメントはインデックスされません。アーカイブされたドキュメントもアーカイブ解除をクリックして解除できます。

***

### 8 ナレッジベースの設定

ナレッジベースの左側ナビゲーションで**設定**をクリックすると、以下の設定項目を変更することができます：

<figure><img src="../../../img/modify-knowledge-base-settings.png" alt=""><figcaption><p>ナレッジベースの設定</p></figcaption></figure>

**ナレッジベース名**、ナレッジベースを識別するための名前を定義します。

**ナレッジベースの説明**、ナレッジベース内のドキュメントが示す情報を説明します。

{% hint style="info" %}
ナレッジベースリコールモードがN選1の場合、ナレッジベースはLLMに推論呼び出し用のツールとして提供され、推論の根拠はナレッジベースの説明に基づきます。説明が空の場合、Difyの自動インデックス戦略が使用されます。
{% endhint %}

**表示権限**、「自分のみ」または「全チームメンバー」を選択できます。権限を持たない人はデータセットを閲覧および編集することができません。

**インデックスモード**、[参考文献](create-knowledge-and-upload-documents.md#suo-yin-fang-shi)

**エンベディングモデル**、ナレッジベースのエンベディングモデルを変更します。エンベディングモデルを変更すると、ナレッジベース内の全てのドキュメントが再度エンベディングされ、以前のエンベディングは削除されます。

**検索設定**、[参考文献](create-knowledge-and-upload-documents.md#jian-suo-she-zhi)

***

### 9 ナレッジベースAPI管理

Difyナレッジベースは標準的なAPIセットを提供しています。開発者はAPI呼び出しを通じて、ナレッジベース内のドキュメントやチャンクのCRUD操作を行うことができます。詳細は[ナレッジベースAPIドキュメント](maintain-dataset-via-api.md)を参照してください。

<figure><img src="../../../img/knowledge-base-api.png" alt=""><figcaption><p>ナレッジベースAPI管理</p></figcaption></figure>