# 召回模式

当用户构建知识库问答类的 AI 应用时，如果在应用内关联了多个知识库，此时需要应用 Dify 的召回策略决定从哪些知识库中检索内容。

<figure><img src="../../../../img/zh-rag-multiple.png" alt=""><figcaption><p>召回模式设置</p></figcaption></figure>

<!-- ### N选1召回模式

根据用户意图和知识库描述，由 Agent 自主判断选择最匹配的单个知识库来查询相关文本，适合知识库区分度大且知识库数量偏少的应用。N选1召回模式依赖模型的推理能力，模型需要根据用户意图，选择最符合的一个知识库召回。在推理选择知识库时，知识库将作为 Agent 的工具类通过意图推理来进行选择，工具描述即知识库描述。

在用户上传知识库时，系统将自动为知识库创建一个摘要式的描述。为了在该模式下获得最佳的召回效果，你可以在“知识库->设置->知识库描述”中查看到系统默认创建的摘要描述，并检查该内容是否可以清晰的概括知识库的内容。

以下是 N 选 1 召回模式的技术流程图：

<figure><img src="../../../.gitbook/assets/image (126).png" alt=""><figcaption><p>N 选 1 召回</p></figcaption></figure>

因此，在查询知识库过多，或者知识库描述差异较小时，该模式的保证召回的效果会受到影响。该模式更适用于知识库数量较少的应用。

提示：OpenAI Function Call 已支持多个工具调用，Dify 将在后续版本中升级该模式为 “N选M召回” 。\\ -->

### 召回设置

根据用户意图同时匹配所有知识库，从多路知识库查询相关文本片段，经过重排序步骤，从多路查询结果中选择匹配用户问题的最佳结果，需配置 Rerank 模型 API。在多路召回模式下，检索器会在所有与应用关联的知识库中去检索与用户问题相关的文本内容，并将多路召回的相关文档结果合并，并通过 Rerank 模型对检索召回的文档进行语义重排序。

在多路召回模式下，建议配置 Rerank 模型。你可以阅读 [重排序](https://docs.dify.ai/v/zh-hans/learn-more/extended-reading/retrieval-augment/rerank) 了解更多。

以下是多路召回模式的技术流程图：

<figure><img src="../../../.gitbook/assets/image (2) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1) (1).png" alt=""><figcaption><p>多路召回</p></figcaption></figure>

由于多路召回模式不依赖于模型的推理能力或知识库描述，该模式在多知识库检索时能够获得质量更高的召回效果，除此之外加入 Rerank 步骤也能有效改进文档召回效果。因此，当创建的知识库问答应用关联了多个知识库时，我们更推荐将召回模式配置为多路召回。
